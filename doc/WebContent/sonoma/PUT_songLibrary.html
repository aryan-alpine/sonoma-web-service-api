<!DOCTYPE html>
<html>
<head>
<meta charset="US-ASCII">
<title>PUT songLibrary</title>
<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<h1>PUT songLibrary</h1>

<p>(1)UPDATE or (2)DELETE songs from the specified song library.</p>


<br/><hr/>
<h2>HTTP Request</h2>

<pre>
PUT /sonoma/songLibrary HTTP/1.1
Host: test.aoavapps.com:443
Authorization: Basic YWxleGFuZGVyLmoucnlhbkBnbWFpbC5jb206YmVhc3Q=

{
    "songLibraryId": "532b7cc10364619a4583aab9",
    "songs": [
        {
            "localSongId": "5261ab190d86fc13754787aa",
            "title": "Let it be"
        },
        {
            "localSongId": "5261ab190d86fc13754787ab",
            "tempo": 200
        },
        {
            "localSongId": "5261ab190d86fc13754787af",
            "iTunesGenre": "Alternative"
        },       
        {
            "localSongId": "5261ab190d86fc13754787ac",
            "userRating": 3.5
        },
        {
            "localSongId": "5261ab190d86fc13754787ae",
            "sonogramImage": "http://test.alpineconnectivity.com:8888/sonoma/sonogramImage/533c5c5d3004762e3ed29238.png"
        },        
        {
            "localSongId": "6261ab190d86fc13754787ad"
        }
    ]
}
</pre>

<p>

NOTE: This service can be used to both  to<br/>
<b>UPDATE</b> existing songs to and <br/>
<b>DELETE</b> existing songs from <br/>
a song library.<br/><br/>

To <b>ADD</b> new songs to a song library,<br/>
you may use the <a href="POST_songLibrary.html">POST songLibrary</a> service. <br/><br/>

The "songLibraryId" of the song is always required.<br/>
The "songLibraryId" + "localSongId" uniquely identifies which song in which library is to be updated.
<br/><br/>

For the individual songs in the array ...<br/>

If the "localSongId" and one or more other fields are specified, <br/>
it is presumed that you wish to <b>UPDATE</b> the values for the specified fields.<br/><br/>

If, however, ONLY the "localSongId" is specified, <br/>
it is presumed that you wish to <b>DELETE</b> the song from the library.<br/>
The song *will* be deleted<br/>
Be very careful, therefore, not to accidently misspell the name of the property of the song that you are trying to update.<br/><br/>


In the example above, it looks like the user:<br/>
(1) Updated 5 existing songs.<br/>
(2) Deleted 1 existing song.<br/><br/>

However, this is NOT what will happen.<br/>
Notice that "userRating" is NOT a valid field.<br/>
When the server receives an invalid field, it will ignore it.<br/>
If there are no valid fields present, it will assume that you want to delete the record.<br/>
The example above will result in 4 records getting updated, and 2 getting deleted.
</p>

<h3>Description</h3>

<p>Data in the JSON ...</p>

<table width="100%" border="1">

<tr>
<td><span style="color:red">songLibraryId</span><br/>(required)</td>
<td>
Used to uniquely identity the songLibrary.<br/>
This is generated by the server the first time that you invoke <a href="POST_songLibrary.html">POST songLibrary</a>
and returned in the JSON.
</td>
</tr>

<tr>
<td><span style="color:red">song.localSongId</span><br/>(required)</td>
<td>
Used to uniquely identify the song in the song library<br/>
This is usually a client specified string.
</td>
</tr>

<tr>
<td>all other fields<br/>(optional)</td>
<td>
See <a href="POST_songLibrary.html">POST songLibrary</a>
</td>
</tr>

<tr>
<td>song.tempo<br/>(optional)</td>
<td>
The <b>tempo</b> field is special because if you update this field, 
we will also update the tempo field in the master record for this song 
and share it with all of the other users who have or will have this song in their library.<br/>
Accordingly, please be careful to only update this field when:<br/>
(1) You have been told by the server that we don't already have tempo info for that song<br/>
(This will happen in the JSON you received when you invoked
 <a href="POST_songLibrary.html">POST songLibrary</a> to send the information originally.)<br/>
(2) You have sampled the song to extract that information 
</td>
</tr>


</table>


<br/><br/>
<br/><hr/>
<h2>HTTP Response: HEAD: Headers</h2>

<p>The following response codes are possible from this service.<br/>
(Client code must handle each of them.):</p>

<ul>
<li><b>200 Success</b></li>
<li><b>207 Multi-Status</b></li>
<li><b>400 Bad Request</b></li>
<li><b>401 Not Authorized</b></li>
<li><b>500 Server Error</b></li>
</ul>


<br/><hr/>
<h2>HTTP Response: Body</h2>

<p>The body of the response should always contain JSON.<br/>
The type of JSON returned varies by the response code.<br/>
5 types of JSON are possible.</p>


<h3>(1) Response Code = 200: &quot;Success&quot; </h3>
<p>If the service executed successfully<br/>
No JSON will be returned.</p>

<b>HTTP REQUEST</b>
<pre>
{
    "songLibraryId": "53c45f2c3004b2e841f8de38",
    "songs": [
        {
            "localSongId": "1",
            "tempo": 91
        },
        {
            "localSongId": "2",
            "tempo": 97,
            "artist": "Dr. Dre"
        }
    ]
}
</pre>


<b>HTTP RESPONSE</b>
<pre>
HTTP/1.1 201 Success

{
    "songLibraryId": "53c45f2c3004b2e841f8de38",
    "songs": [
        {
            "id": "53c9bd8ada0679af7291c7e7",
            "localSongId": "1",
            "alpineSongId": "539a5959e4b0a69a942f3d56",
            "artist": "Snoop Dogg",
            "title": "Ain't No Fun (If The Homies Can't Have None)",
            "tempo": 91,
            "serverTopGenre": "Hip-Hop / Rap",
            "created": 1405730186769,
            "updated": 1405746225340,
            "master": {
                "id": "539a5959e4b0a69a942f3d56",
                "artist": "Snoop Dogg",
                "title": "Ain't No Fun (If The Homies Can't Have None)",
                "tempo": 91,
                "energy": 2,
                "topGenre": "Hip-Hop / Rap",
                "created": 1402624345036,
                "updated": 1405746106582
            }
        },
        {
            "id": "53c9bd8ada0679af7291c7e8",
            "localSongId": "2",
            "alpineSongId": "5397987de4b016e9797c3942",
            "artist": "Dr. Dre",
            "title": "Bitches Ain't Shit",
            "tempo": 97,
            "serverTopGenre": "Hip-Hop / Rap",
            "created": 1405730186769,
            "updated": 1405746225340,
            "master": {
                "id": "5397987de4b016e9797c3942",
                "artist": "Dr. Dre",
                "title": "Bitches Ain't Shit",
                "tempo": 96,
                "energy": 2,
                "topGenre": "Hip-Hop / Rap",
                "created": 1402443901382,
                "updated": 1405708078931
            }
        }
    ]
}

</pre>

 
<h3>Description</h3>

<p>
You can expect to receive a full listing of all data for every song that was updated in the response.<br/>
There will be no mention of songs that were deleted in the response.<br/><br/>
When the PUT request updates the <b>tempo</b> of the song,<br/>
and the master record for this song does not already have tempo value > 10,<br/>
the new value will be stored in the master record and made available to all other users
who have this song in their libraries.<br/>
Also, whenever the tempo of the master record is updated in this fashion,
this will trigger a recalculation of the energy level.<br/><br/>
</p>

<!-- 
<p>Data in the JSON ...</p>




<table width="100%" border="1">


<tr>
<td><span style="color:red">id</span><br/>(guaranteed)</td>
<td>
The "song library id".<br/>
All operations on the contents of this user library must specify this id.<br/>
Only the user who created this the song library may request operations on it.<br/>
Only 1 song library is permitted per device.
</td>
</tr>


<tr>
<td><span style="color:red">song.id</span><br/>(guaranteed)</td>
<td>
The "id" that is returned is the unique identifier for each of the individual songs.<br/>
This "id" should be associated with each of the individual songs on the client and used whenever
any operations on the individual song is requested later. For example, if the user wants to "rate"
the song or "delete" the song from their library, this id is required in the request in order
to identify the song to which the desired operation is to be performed.
</td>
</tr>


<tr>
<td><span style="color:red">song.artist</span><br/>(guaranteed)</td>
<td>
Returned to enable the caller to match the generated id to the appropriate song.
</td>
</tr>

<tr>
<td><span style="color:red">song.title</span><br/>(guaranteed)</td>
<td>
Returned to enable the caller to match the generated id to the appropriate song.
</td>
</tr>



</table>

 -->
 

<!--  
<h3>(2) Response Code = 207: &quot;Multi-Status&quot; </h3>
<p>If the service executed successfully<br/>
JSON like the following will be returned in the body of the response:</p>

<pre>
HTTP/1.1 207 Multi-Status

{
    "id": "123456789abcdef",
    "songs": [
        {
            "localSongId": "5261ab190d86fc13754787ae",
            "artist": "The Beatles",
            "title": "Let it be"
        },
        {
            "localSongId": "6261ab190d86fc13754787ae",
            "artist": "The Beatles",
            "title": "Hey Jude"
        }
    "errors": [
        {
            "localSongId": "5261ab190d86fc13754787ab",
            "artist": "Yanni",
            "title": "A love for life",
            "messsage" : "Failed to ADD. Too gay."
        },
        {
            "localSongId": "6261ab190d86fc13754787ac",
            "artist": "Yanni",
            "title": "A night to remember.",
            "messsage" : "Failed to UPDATE. Yanni does not compute! Try another artist."
        }        
        
        
    ]
}
</pre>
-->


<h3>(3) Response Code = 400: &quot;Bad Request&quot; </h3>
<p>If there was a major error in the request that prevents us from even processing it,<br/>
the standard JSON describing the error will be returned in the body of the response:</p>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 1,
    "errorMessage": "INVALID JSON",
    "data": "No JSON was POSTed!"
}
</pre>


<h3>(4) Response Code = 401: &quot;Not Authorized&quot; </h3>
<p>If a valid username/password was not passed via the Basic Authentication mechanism,
this error code will be returned.</p>

<pre>
HTTP/1.1 401 Not Authorized
WWW-Authenticate: Basic realm="alpineconnectivity.com"

{
    "errorCode": 401,
    "errorMessage": "Not Authorized",
    "data": "Authorization header was not found."
}
</pre>


<h3>(5) Response Code = 500: &quot;Server Error&quot; </h3>
<p>If there was a major error on the server that prevents us fulfilling to the request,<br/>
the standard JSON describing the error will be returned in the body of the response:</p>

<pre>
HTTP/1.1 500 Server Error

{
    "errorCode": 3,
    "errorMessage": "SERVER ERROR",
    "data": "Error inserting record into the database.."
}
</pre>

<!--  
<br/><hr/>
<h2>Example Java code</h2>

<pre>


</pre>
-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48110106-1', 'alpineconnectivity.com');
  ga('send', 'pageview');

</script>
</body>
</html>