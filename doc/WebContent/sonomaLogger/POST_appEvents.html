<!DOCTYPE html>
<html>
<head>
<meta charset="US-ASCII">
<title>POST appEvents</title>
<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<h1>POST appEvents</h1>

<p>Save a records of application events to the server.</p>


<br/><hr/>
<h2>HTTP Request</h2>

<h3>Example:</h3>

<pre>
POST /sonomaLogger/appEvents HTTP/1.1
Host: test1Log.aosvapps.com:443
Authorization: Basic YWxleGFuZGVyLmoucnlhbkBnbWFpbC5jb206YmVhc3Q=

[
    {
        "apiVersion": 1,
        "sessionId": 1374616410211,
        "time": 1374616410211,
        "origin": "user",
        "module": "levelPlay",
        "type": "SONG_PLAYED",
        "details": {
            "alpineSongId": "52a67d480364cb0ef3d4f563",
            "songLength": 123,
            "durationPlayed": 123,
            "percentPlayed": 100,
            "startTime": 1396280734,
            "endTime": 1396280000,
            "isManual": true,
            "skipped": [
                "52a67d480364cb0ef3d4f560",
                "52a67d480364cb0ef3d4f561",
                "52a67d480364cb0ef3d4f562"
            ]
        },
        "app": {
            "name": "sonoma",
            "version": "1",
            "build": 946,
            "buildType": 1,
            "foreground": true
        },
        "device": {
            "type": "android",
            "osBuild": "2.3.4",
            "id": "add0d21b-634e-4c04-9677-cbc24231aa29",
            "phoneSpec": "motorolaDROIDX",
            "wifiMAC": "f8: 7b: 7a: 84: da: 02"
        },
        "location": {
            "locSpec": "gps",
            "lts": 1374616394000,
            "acc": 64,
            "latitude": "37.379425",
            "longitude": "-121.961395",
            "spd": "0"
        }
    }
]
</pre>


<p>Every event has a unique <b>type</b>. There are a finite number of event types in the application.<br/><br/>

The JSON is the same for all events with 1 exception:<br/>
The contents of the <b>details</b> property will vary by event type.<br/><br/>

Events are classified by 2 different classification schemes:<br/><br/>
(1) <b>originCategory</b> = {user, network, other}<br/>
A user event is some interaction with the user.<br/>
A network event is some interaction with another system across the network.<br/>
An other event is everything else.<br/><br/>
(2) <b>functionalCategory</b> = {utility, levelPlay, classicPlay}<br/>
All events of type user, may be functionally divided into these 3 categories.<br/>
This enables us to see what features are being used and not used by users.
</p>

<br/><hr/>
<h2>HTTP Request: BODY: Parameters</h2>

<p>For each individual record in the array of records ...</p>

<table width="100%" border="1">


<tr>
<td><span style="color:red">apiVersion</span><br/>(required)</td>
<td>
The version of the version of the JSON appEvent logging API that the caller is using.</td>
</tr>

<tr>
<td><span style="color:red">sessionId</span><br/>(required)</td>
<td>A id generated by the client to indicate a *new* interaction with the server.<br/>
This should be the epochTime of the first appEvent of the session.<br/>
Rules:<br/> 
If the app is restarted, a new sessionId should be generated.<br/>
If the app continues to run for more than 30 mins without any value exchange,
a new sessionId should be generated.<br/>
Note: If music is playing for more than 30 mins but the user does not trigger
any events, a new sessionId is not generated because we *assume* that the user 
is receiving value by listening to the music.</td>
</tr>

<tr>
<td><span style="color:red">time</span><br/>(required)</td>
<td>The epochTime that the event occurred.</td>
</tr>

<tr>
<td><span style="color:red">type</span><br/>(required)</td>
<td>
The type of the event that occurred.<br/>
e.g. "songPlayed".</td>
</tr>

<tr>
<td><span style="color:red">details</span><br/>(required)</td>
<td>
The details of the event.<br/>
NOTE: the content of the event details varies based on the name of the event.</td>
</tr>

<tr>
<td><span style="color:red">origin</span><br/>(required)</td>
<td>
For Sonoma, this is one of {user, http, other}.<br/>
e.g. "songPlayed".</td>
</tr>

<tr>
<td><span style="color:red">module</span><br/>(required)</td>
<td>
For Sonoma, this is one of {utility, levelPlay, classicPlay}<br/>
Every application event falls into one of these functional categories.<br/>
Having this information enables us to calculate how much time the user is spending in each functional category.<br/>
NOTE: Events are not owned by functional Categories. "songPlayed" can occur within either a levelPlay or classicPlay context.</td>
</tr>

<tr>
<td><span style="color:red">app.name</span><br/>(required)</td>
<td>
The name of the application making the request. e.g. "sonoma"</td>
</tr>

<tr>
<td><span style="color:red">app.version</span><br/>(required)</td>
<td>
The version of the application making the request. e.g. "sonoma"</td>
</tr>


<tr>
<td><span style="color:red">app.build</span><br/>(required)</td>
<td>
The build number of the app that is logging. This must be an integer.</td>
</tr>


<tr>
<td><span style="color:red">app.buildType</span><br/>(required)</td>
<td>
An integer. A value of 0 represents a production build released via the app store.
 All other buildTypes are non-zero.</td>
</tr>




<tr>
<td><span style="color:red">app.foreground</span><br/>(required)</td>
<td>
Was the app in the foreground when the event occurred? true or false</td>
</tr>


<tr>
<td><span style="color:red">device.type</span><br/>(required)</td>
<td>android or iphone</td>
</tr>

<tr>
<td><span style="color:red">device.osBuild</span><br/>(required)</td>
<td>Which version of the operating system.</td>
</tr>


<tr>
<td><span style="color:red">device.id</span><br/>(required)</td>
<td>This is the deviceId of the device sending the request.</td>
</tr>


<tr>
<td><span style="color:red">device.phoneSpec</span><br/>(required)</td>
<td>Hardware make and model.</td>
</tr>


<tr>
<td><span style="color:black">device.wifiMAC</span><br/>(optional)</td>
<td></td>
</tr>


<tr>
<td><span style="color:black">location.lts</span><br/>(optional)</td>
<td>location time stamp. This is the time that the location data was gathered.
 It may be significantly different than the ts of the event.
 If so the event might not have occurred in that location.</td>
</tr>

<tr>
<td><span style="color:black">location.locSpec</span><br/>(optional)</td>
<td>
The method used to determine the current location of the device.<br/>
One of {gps, network, passive}.</td>
</tr>


<tr>
<td><span style="color:black">location.latitude</span><br/>(optional)</td>
<td></td>
</tr>

<tr>
<td><span style="color:black">location.longitude</span><br/>(optional)</td>
<td></td>
</tr>


<tr>
<td><span style="color:black">location.acc</span><br/>(optional)</td>
<td>The accuracy of the location data.</td>
</tr>

<tr>
<td><span style="color:black">location.spd</span><br/>(optional)</td>
<td>The current speed of the device.</td>
</tr>


</table>

<br/><br/>
<br/><hr/>
<h2>HTTP Response: HEAD: Headers</h2>

<p>The following response codes are possible from this service.<br/>
(Client code must handle each of them.):</p>

<ul>
<li>201 Created</li>
<li>207 Multi-Status: There was at least one error.</li>
<li>400 Bad Request</li>
<li>500 Server Error</li>
</ul>

<p>
The content of the body of the HTTP Response will always be JSON.<br/>
Therefore, the following header will always be sent:<br/>
<b>Content-Type: application/json</b>
</p>






<br/><hr/>
<h2>HTTP Response: Example (success)</h2>

<pre>
HTTP/1.0 201 Created
Content-Type: "application/json"
{
    "numberOfRecordsReceived": 4,
    "numberOfRecordsProcessed": 4,
    "numberOfErrors": 0,
    "errors": []
}
</pre>


<br/><hr/>
<h2>HTTP Response: Example (failure)</h2>


<pre>
HTTP/1.0 400 Bad Request
Content-Type: "application/json"
{
    "errorCode": 1,
    "errorMessage": "INVALID JSON received in the HTTP REQUEST: No JSON was POSTed!"
}
</pre>


<br/><hr/>
<h2>HTTP Response: Example (failure)</h2>

<pre>
HTTP/1.0 400 Bad Request
Content-Type: "application/json"
{
    "errorCode": 1,
    "errorMessage": "INVALID JSON received in the HTTP REQUEST: JSON is not valid."
}
</pre>


<br/><hr/>
<h2>HTTP Response: Example (failure)</h2>
<pre>
HTTP/1.0 500 Server Error
Content-Type: "application/json"
{
    "errorCode": 3,
    "errorMessage": "Server Error"
    "data": "Try again later."
}
</pre>


<br/><hr/>
<h2>HTTP Response: Examples (Mixed results)</h2>
HTTP/1.0 207 Multi-status
Content-Type: "application/json"

<pre>
{
    "numberOfRecordsReceived": 100,
    "numberOfRecordsProcessed": 91,
    "numberOfErrors": 9,
    "errors": [
        {
            "record": "1",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "apiKey was unspecified"
        },
        {
            "record": "2",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "dev (deviceId) was not specified"
        },
        {
            "record": "3",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "app was not specified"
        },
        {
            "record": "4",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "user was not specified"
        },
                {
            "record": "5",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "msgId was not specified"
        },
        {
            "record": "6",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "act was unspecified"
        },
        {
            "record": "7",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "updateTime was not specified"
        },
        {
            "record": "8",
            "errorCode": 1,
            "errorMessage": "Invalid JSON",
            "data": "updateTime (0) is invalid.\nCorresponding DateTime is: 1969-12-31T4:0:00-0800\nCurrent DateTime is: 2013-08-07T5:16:55-0700\nCan't be more than 10 minutes into the future. \nCannot be more than 365 days into the past."
        },
        {
            "record": "9",
            "errorCode": 3,
            "errorMessage": Server Error",
            "data": "Try again later."
        }
    ]
}
</pre>



<p>This list is not comprehensive.</p>



<br/><hr/>
<h2>Event Types</h2>

<p>The following is the list of app event types that the server expects to receive from clients
 and the data it expects to receive for each type.</p>


<table border="1">
<thead>
<th>type</th>
<th>data</th>
</thead>
<tbody>
<tr>
<td>songRecommendationRequestReceived</td>
<td>
<pre>
{
    "eventCategory": "http",
    "peformance": {
        "timeRequestSent": 1,
        "timeResponseReceived": 2,
        "responseTime": 1.2234
    },
    "request": {
        "parameters": {
            "genre": "rap",
            "tempo": 125
        }
    },
    "response": {
        "recommendationId": "5330a192da060025eb667ac1",
        "userId": "alexander.j.ryan@gmail.com",
        "deviceId": "D6735C05A22643B395967FF83CB52251",
        "songLibraryId": "5330a192da060025eb667ac1",
        "songs": [
            {
                "localSongId": "3",
                "score": 4.52
            },
            {
                "localSongId": "1",
                "score": 4.43
            },
            {
                "localSongId": "4",
                "score": 4.33
            },
            {
                "localSongId": "2",
                "score": 4.22
            }
        ]
    }
}
</pre>
</td>
</tr>
<tr>
<td>songPlayed</td>
<td>
<pre>
{
    "recommendationId": "52a7bbbc0364f68ae82a94c1",
    "songLibraryId": "52a67d480364cb0ef3d4f563",
    "localSongId": 22,
    "songLength": 123,
    "durationPlayed": 123,
    "percentPlayed": 100,
    "startTime": 1396280734,
    "endTime": 1396280000,
    "isManual": true
}
</pre>
</td>
</tr>
</tbody>
</table>




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48110106-1', 'alpineconnectivity.com');
  ga('send', 'pageview');

</script>
</body>
</html>