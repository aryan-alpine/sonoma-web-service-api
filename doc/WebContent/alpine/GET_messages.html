<!DOCTYPE html>
<html>
<head>
<meta charset="US-ASCII">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<h1>GET messages</h1>

<p>GET a list of messages<br/>
for a particular application<br/>
for a particular user<br/>
of a particular type</p>

<p>There are 2 variants of this service:<br/>
<b>GET inbox</b><br/>
<b>GET outbox</b><br/><br/>

Everything in this spec applies to both of them.<br/>
However, the <b>inbox</b> will only contain "alert" messages.<br/>
The <b>outbox</b> can contain "email", "sms" and "alert" messages.</p>

<br/><hr/>
<h2>HTTP Request: Headers</h2>

<p>The request method is GET.<br/>
For example:</p>

<pre>
GET inbox/app/places/user/bigWayne/lastId/507c35dd8fada716c89d0013 HTTP/1.1
Host: dev5:8888
</pre>

<pre>
GET outbox/app/places/user/bigWayne/lastId/507c35dd8fada716c89d0013 HTTP/1.1
Host: dev5:8888
</pre>

<p>This service may only be used by registered users who are authorized to use it.<br/>
The HTTP Basic Authentication scheme is used to pass the encoded username:password of the user.</p>


<br/><hr/>
<h2>HTTP Request: Headers: Request Method Parameters</h2>

<p>One way to pass data to a service is via the parameters of the "request method"
in the "headers" section of the HTTP request.<br/>
This is most frequently done when the request method is GET.<br/>
<b>GET messages</b> utilizes this approach like so ...

<div id="requestMethodParameters">
Expected Parameters:<br/>
GET inbox/<b>app</b>/[app]/<b>user</b>/[user]/<b>lastId</b>/[lastId]/<b>type</b>/[messageClass]<br/>
GET outbox/<b>app</b>/[app]/<b>user</b>/[user]/<b>lastId</b>/[lastId]/<b>type</b>/[messageClass]
</div>

<p>Client app pulls new messages for the user like so ..<br/><br/>

The client app will send up the lastId <br/>
for a particular user<br/>
and the service will return all messages that are NEWER
than the message with the specified lastId.<br/><br/>

The lastId refers to an id that gets generated by the server for message sent via the POST message service<br/>
The id is a 24 character hexidecimal number.<br/>
Each id is guaranted to be a higher number than any message sent previously via the POST message service.<br/><br/>

If the lastId=0, the service will simply return all messages recieved.<br/>
It will not check the timestamps.<br/><br/>

A maximum of 100 messages will be returned at a time.<br/>
If the client received 100 messages, and desires to receive more, <br/>
it should call the "GET messages" service again with the lastId of the last of the 100 records received.<br/><br/>

Note: The "GET messages" service does not keep track of what messages have already been retrieved by clients.<br/>
It simply sends the list of messages requested.<br/>
Your users may use multiple devices for messaging.<br/>
It is the responsibility of the device developer to keep these lists of messages in-synch on multiple devices.<br/><br/>

Optionally, the client app may also specify the <b>type</b> of message.<br/>
If the <b>type</b> is specified, only messages of the specified type<br/>
posted AFTER the lastId will be returned.
</p>


<h3>Example</h3>

<pre>
GET inbox/app/places/user/bigWayne/lastId/123/type/alert HTTP/1.1
Host: dev5:8888
</pre>


<pre>
GET outbox/app/places/user/bigWayne/lastId/123/type/alert HTTP/1.1
Host: dev5:8888
</pre>


<h3>Description</h3>

<p>For each individual input parameter ...</p>

<table width="100%" border="1">

<tr>
<td>app<br/>(required)</td>
<td>
The name of the application making the request. e.g. "SnapGas"
</td>
</tr>

<tr>
<td>user<br/>(required)</td>
<td>
The unique userId of the person making the change.<br/>
</tr>

<tr>
<td>lastId<br/>(required)</td>
<td>
The lastId refers to an id that gets generated enerated by the server for message sent via the POST message service<br/>
The id is a 24 character hexidecimal number.<br/>
Each id is guaranted to be a higher number than any message sent previously via the POST message service.<br/><br/>
</td>
</tr>

<tr>
<td>type (optional)</td>
<td>Must be one of {Honeydo, TrafficAlert, PoiForwarding, AlpineAlert}</td>
</tr>

</table>


<br/><hr/>
<h2>HTTP Request: BODY: Parameters</h2>

<p>Another way to pass data to a service is via the body of the HTTP request.<br/>
This method is not used when the request method is GET.<br/>
This service does not pass data in this fashion..</p>


<br/><hr/>
<h2>HTTP Response: HEAD: Headers</h2>

<p>The following response codes are possible from this service.<br/>
(Client code must handle each of them.):</p>

<ul>
<li><b>200 Success</b></li>
<li><b>400 Bad Request</b></li>
<li><b>500 Server Error</b></li>
</ul>

<p>
The content of the body of the HTTP Response will always be JSON.<br/>
Therefore, the following header will always be sent:<br/>
<b>Content-Type: application/json</b>
</p>


<br/><hr/>
<h2>HTTP Response: Body</h2>

<p>The body of the response should always contain JSON.<br/>
The type of JSON returned varies by the response code.<br/>
3 types of JSON are possible.</p>


<h3>(1) Response Code = 200: &quot;Success&quot; </h3>
<p>If the service executed successfully<br/>
JSON like the following will be returned in the body of the response:</p>

<pre>
HTTP/1.1 200 Success

[
    {
        "subject": "How awesome I am",
        "message": "Just sending this message to you to remind you how awesome I am ...",
        "recipients": [
            {
                "type": "sms",
                "name": "Alex Android",
                "phone": "4085972947"
            },
            {
                "type": "email",
                "name": "Alex Alpine",
                "email": "aryan@alpineconnectivity.com"
            }
        ],
        "messageClass": "TrafficAlert",
        "latitude": "37.379425",
        "longitude": "-121.961395",
        "dev": "add0d21b-634e-4c04-9677-cbc24231aa29",
        "app": "TestMyplacelist",
        "user": "alexander.j.ryan@gmail.com",
        "id": "522a664730045ad7125414cc"
    },
    {
        "subject": "How awesome I am",
        "message": "Just sending this message to you to remind you how awesome I am ...",
        "recipients": [
            {
                "type": "sms",
                "name": "Alex Android",
                "phone": "4085972947"
            },
            {
                "type": "email",
                "name": "Alex Alpine",
                "email": "aryan@alpineconnectivity.com"
            }
        ],
        "messageClass": "TrafficAlert",
        "latitude": "37.379425",
        "longitude": "-121.961395",
        "dev": "add0d21b-634e-4c04-9677-cbc24231aa29",
        "app": "TestMyplacelist",
        "user": "alexander.j.ryan@gmail.com",
        "id": "522a686b300493b956a79cb8"
    },
    {
        "subject": "How awesome I am",
        "message": "Just sending this message to you to remind you how incredibly handsome I am ...",
        "recipients": [
            {
                "type": "email",
                "name": "Alex Alpine",
                "email": "aryan@alpineconnectivity.com"
            }
        ],
        "messageClass": "TrafficAlert",
        "latitude": "37.379425",
        "longitude": "-121.961395",
        "dev": "add0d21b-634e-4c04-9677-cbc24231aa29",
        "app": "TestMyplacelist",
        "user": "alexander.j.ryan@gmail.com",
        "id": "522a6e0f3004b6c7cbba3410"
    }
]


</pre>


<h3>(2) Response Code = 400: &quot;Bad Request&quot; </h3>
<p>If there was a major error in the request that prevents us from even processing it,<br/>
the standard JSON describing the error will be returned in the body of the response:</p>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "app not specified"
}
</pre>


<h3>(3) Response Code = 500: &quot;Server Error&quot; </h3>
<p>If there was a major error on the server,<br/>
the standard JSON describing the error will be returned in the body of the response:</p>

<pre>
HTTP/1.1 500 Server Error

{
    "errorCode": 3,
    "errorMessage": "SERVER ERROR",
    "data": "Unable to connect to the database."
}
</pre>


<br/><hr/>
<h2>HTTP Response: Example ERRORS</h2>

<p>The following responses illustrates the most commonly occurring 
reasons why the service fails to return a 200 response code.</p>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "app not specified"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "specified app is invalid. Must be one of {?,?,?}"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "user not specified"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "specified user is invalid"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "lastId not specified"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "specified lastId is invalid"
}
</pre>

<pre>
HTTP/1.1 400 Bad Request

{
    "errorCode": 2,
    "errorMessage": "INVALID PARAMS",
    "data": "URL path should look like this:
        outbox/app/[app]/user/[user]/lastId/[lastId]/type/[type]
     OR outbox/app/[app]/user/[user]/lastId/[lastId]
     OR inbox/app/[app]/user/[user]/lastId/[lastId]/type/[type]
     OR inbox/app/[app]/user/[user]/lastId/[lastId]/ 
     but we received: 
     http://localhost:8080/alpine/outbox/app/TestMyplacelist/usr/alexander.j.ryan@gmail.com/lastId/521800200d8687380b12abe4"
}
</pre>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48110106-1', 'alpineconnectivity.com');
  ga('send', 'pageview');

</script>
</body>
</html>